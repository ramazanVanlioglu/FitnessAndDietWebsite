<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness Programım | DietFit</title>
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/menubar.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .workout-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      justify-content: center;
      margin: 36px 0 24px 0;
    }
    .workout-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 18px rgba(46,139,87,0.10);
      padding: 28px 22px 18px 22px;
      min-width: 220px;
      max-width: 260px;
      flex: 1 1 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.2s, transform 0.2s;
      cursor: pointer;
      border: 2px solid #e0e0e0;
    }
    .workout-card.selected, .workout-card:hover {
      box-shadow: 0 8px 32px rgba(46,139,87,0.18);
      border: 2px solid #2e8b57;
      transform: translateY(-2px) scale(1.03);
    }
    .workout-card h3 {
      color: #2e8b57;
      margin-bottom: 10px;
      font-size: 1.2rem;
    }
    .workout-card p {
      color: #444;
      font-size: 0.98rem;
      margin-bottom: 18px;
      text-align: center;
    }
    .select-btn {
      background: #2e8b57;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 18px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .select-btn:hover {
      background: #256d46;
    }
    .workout-detail {
      margin: 36px auto 0 auto;
      max-width: 520px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(46,139,87,0.10);
      padding: 32px 28px;
      text-align: center;
      display: none;
    }
    .workout-detail.active {
      display: block;
    }
    .workout-detail h2 {
      color: #2e8b57;
      margin-bottom: 18px;
    }
    .workout-detail p {
      color: #333;
      font-size: 1.08rem;
      margin-bottom: 10px;
    }
    .workout-days {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin: 32px 0 0 0;
    }
    .workout-day-col {
      min-width: 90px;
      min-height: 60px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 2px dashed #2e8b57;
      text-align: center;
      padding: 10px 4px;
      transition: background 0.2s;
      position: relative;
    }
    .workout-day-col:hover {
      background: #e8f5e9;
    }
    .assigned-program {
      min-height: 24px;
      font-weight: bold;
      color: #2e8b57;
    }
    @media (max-width: 700px) {
      .workout-cards { flex-direction: column; gap: 16px; }
      .workout-card { min-width: unset; max-width: 100%; }
      .workout-detail { padding: 18px 6px; }
    }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="navbar-container">
        <a href="./index.html" class="logo">DietFit</a>
        <button class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
        <ul class="menu" id="mainMenu"></ul>
        <div class="auth-buttons">
          <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search..." oninput="showSuggestions()" />
            <button><i class="fas fa-search"></i></button>
            <ul id="suggestionsList" class="suggestions"></ul>
          </div>
          <button onclick="location.href='login.html'"><i class="fas fa-sign-in-alt"></i> Giriş Yap</button>
          <button onclick="location.href='register.html'"><i class="fas fa-user-plus"></i> Kaydol</button>
        </div>
        <div class="user-menu" style="display:none;">
          <button class="user-menu-btn" onclick="toggleUserMenu()">
            <i class="fas fa-user-circle"></i> <span id="userName">Kullanıcı</span> <i class="fas fa-caret-down"></i>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <a href="#" id="profile-link"><i class="fas fa-id-card"></i> Kullanıcı Bilgilerim</a>
            <a href="#" id="inbox-link" style="display:none;"><i class="fas fa-inbox"></i> Gelen Kutusu</a>
            <a href="#" onclick="logoutUser(event)"><i class="fas fa-sign-out-alt"></i> Çıkış Yap</a>
          </div>
        </div>
      </div>
    </nav>
  </header>
  <main style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;">
    <div class="workout-cards" id="workoutCards">
      <!-- Kartlar JS ile doldurulacak -->
    </div>
    <div class="workout-days" id="workoutDays" style="display:flex;gap:12px;justify-content:center;margin:32px 0 0 0;">
      <!-- Günler sütunu JS ile doldurulacak -->
    </div>
    <div class="workout-detail" id="workoutDetail">
      <!-- Seçilen programın detayları burada gösterilecek -->
    </div>
    <!-- Kaydet butonu ve popup mesajı için alan -->
    <button id="saveBtn" class="select-btn" style="margin:24px auto 0 auto;display:none;font-size:1.08rem;min-width:120px;">Kaydet</button>
    <div id="popupMsg" style="display:none;"></div>
  </main>
  <footer>
    <p>&copy; 2025 DietFit. Tüm hakları saklıdır.</p>
  </footer>
  <script src="../../js/menubar.js"></script>
  <script>
    // Fitness program türleri ve açıklamaları
    const workouts = [
      {
        name: 'İtiş Hareketleri',
        short: 'Göğüs, omuz ve triceps kaslarını çalıştıran temel hareketler.',
        detail: 'İtiş hareketleri, bench press, şınav, overhead press gibi egzersizleri içerir. Üst vücut kaslarının gelişimi ve güçlenmesi için temel bir antrenman grubudur.'
      },
      {
        name: 'Çekiş Hareketleri',
        short: 'Sırt ve biceps kaslarını hedefleyen çekme egzersizleri.',
        detail: 'Çekiş hareketleri, barfiks, row, lat pulldown gibi egzersizleri kapsar. Sırt kaslarının kalınlaşması ve kol kaslarının güçlenmesi için önemlidir.'
      },
      {
        name: 'Bacak Antrenmanı',
        short: 'Tüm bacak kaslarını çalıştıran temel ve izole hareketler.',
        detail: 'Squat, lunge, leg press gibi egzersizlerle bacak kasları güçlendirilir. Alt vücut gelişimi ve genel denge için gereklidir.'
      },
      {
        name: 'Kardiyo',
        short: 'Dayanıklılığı ve kalp sağlığını artıran egzersizler.',
        detail: 'Koşu, bisiklet, ip atlama gibi aktivitelerle kalp-damar sağlığı desteklenir, yağ yakımı hızlanır.'
      },
      {
        name: 'HIIT Kardiyo',
        short: 'Yüksek yoğunluklu aralıklı antrenman ile kısa sürede maksimum yağ yakımı.',
        detail: 'HIIT, kısa süreli yüksek yoğunluklu egzersizlerle düşük yoğunluklu dinlenme aralarını birleştirir. Metabolizmayı hızlandırır ve kısa sürede etkili sonuçlar sağlar.'
      }
    ];
    const cardsDiv = document.getElementById('workoutCards');
    const detailDiv = document.getElementById('workoutDetail');
    const daysDiv = document.getElementById('workoutDays');
    const days = ['Pazartesi','Salı','Çarşamba','Perşembe','Cuma','Cumartesi','Pazar'];
    // Günler sütununu oluştur
    const dayAssignments = Array(7).fill(null);
    // --- Atama işlemleri için yardımcı fonksiyonlar ---
    // Programlar ile veritabanı id eşlemesi (sıra: 0,1,2...)
    const programIdMap = [1,2,3,4,5]; // Veritabanındaki fitness programlarının id'leri sırasıyla (gerekirse backend'den dinamik çekilebilir)

    // Atamaları backend'den çek
    async function loadAssignments() {
      const resp = await fetch('/api/get-assignments?type=fitness');
      if (resp.ok) {
        const data = await resp.json();
        if (Array.isArray(data.assignments)) {
          for (let i = 0; i < 7; i++) {
            dayAssignments[i] = data.assignments[i] !== null ? programIdMap.indexOf(data.assignments[i]) : null;
          }
          updateDayAssignments();
        }
      }
    }
    // Atamaları backend'e kaydet
    async function saveAssignments() {
      // Program id'lerini gönder
      const assignments = dayAssignments.map(idx => idx !== null ? programIdMap[idx] : null);
      await fetch('/api/save-assignments', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ assignments, type: 'fitness' })
      });
    }
    // Gün ataması değiştiğinde kaydet
    function onAssignmentChange() {
      updateDayAssignments();
      saveAssignments();
    }
    days.forEach((day, idx) => {
      const dayCol = document.createElement('div');
      dayCol.className = 'workout-day-col';
      dayCol.style.cssText = 'min-width:90px;min-height:60px;background:#f9f9f9;border-radius:8px;border:2px dashed #2e8b57;text-align:center;padding:10px 4px;transition:background 0.2s;position:relative;';
      dayCol.innerHTML = `<div style=\"font-weight:bold;color:#2e8b57;margin-bottom:6px;\">${day}</div><div class=\"assigned-program\" style=\"min-height:24px;\"></div><button class=\"remove-btn\" style=\"margin-top:8px;display:none;background:#e53935;color:#fff;border:none;border-radius:5px;padding:4px 10px;cursor:pointer;font-size:0.95rem;\">Hareketi Kaldır</button>`;
      dayCol.ondragover = e => { e.preventDefault(); dayCol.style.background='#e8f5e9'; };
      dayCol.ondragleave = e => { dayCol.style.background='#f9f9f9'; };
      dayCol.ondrop = e => {
        e.preventDefault();
        dayCol.style.background='#f9f9f9';
        const idx = +dayCol.getAttribute('data-idx');
        const progIdx = +e.dataTransfer.getData('progIdx');
        dayAssignments[idx] = progIdx;
        onAssignmentChange();
      };
      dayCol.setAttribute('data-idx', idx);
      // Remove button click
      dayCol.querySelector('.remove-btn').onclick = function() {
        const idx = +dayCol.getAttribute('data-idx');
        dayAssignments[idx] = null;
        onAssignmentChange();
      };
      daysDiv.appendChild(dayCol);
    });
    // Kartları oluştur
    workouts.forEach((workout, idx) => {
      const card = document.createElement('div');
      card.className = 'workout-card';
      card.setAttribute('draggable', 'true');
      card.innerHTML = `<h3>${workout.name}</h3><p>${workout.short}</p><button class="select-btn">Programı Seç</button>`;
      card.ondragstart = e => { e.dataTransfer.setData('progIdx', idx); };
      card.querySelector('.select-btn').onclick = function(e) {
        document.querySelectorAll('.workout-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        detailDiv.innerHTML = `<h2>${workout.name}</h2><p>${workout.detail}</p>`;
        detailDiv.classList.add('active');
        detailDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };
      cardsDiv.appendChild(card);
    });
    function updateDayAssignments() {
      document.querySelectorAll('.workout-day-col').forEach((col, idx) => {
        const progIdx = dayAssignments[idx];
        const progDiv = col.querySelector('.assigned-program');
        progDiv.innerHTML = '';
        if (progIdx !== null && workouts[progIdx]) {
          progDiv.textContent = workouts[progIdx].name;
          // Kaldır butonu ekle
          const removeBtn = document.createElement('button');
          removeBtn.textContent = 'Hareketi Kaldır';
          removeBtn.className = 'remove-btn';
          removeBtn.style = 'margin-left:8px;background:#e53935;color:#fff;border:none;border-radius:4px;padding:2px 8px;font-size:0.92rem;cursor:pointer;';
          removeBtn.onclick = function(e) {
            dayAssignments[idx] = null;
            onAssignmentChange();
          };
          progDiv.textContent = workouts[progIdx].name + ' ';
          progDiv.appendChild(removeBtn);
        } else {
          progDiv.textContent = '';
        }
      });
    }
    // --- KAYDET BUTONU ve POPUP ---
    // Popup göster
    function showPopup(msg) {
      let popup = document.getElementById('popupMsg');
      if (!popup) {
        popup = document.createElement('div');
        popup.id = 'popupMsg';
        popup.style = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#2e8b57;color:#fff;padding:24px 36px;border-radius:12px;z-index:9999;font-size:1.2rem;box-shadow:0 8px 32px rgba(46,139,87,0.18);display:none;';
        document.body.appendChild(popup);
      }
      popup.textContent = msg;
      popup.style.display = 'block';
      setTimeout(() => { popup.style.display = 'none'; }, 1800);
    }
    // Kaydet butonunu dinamik ekle (main'in en altına)
    let saveBtn = document.getElementById('saveBtn');
    if (!saveBtn) {
      saveBtn = document.createElement('button');
      saveBtn.id = 'saveBtn';
      saveBtn.textContent = 'Kaydet';
      saveBtn.className = 'select-btn';
      saveBtn.style = 'margin:24px auto 0 auto;display:block;font-size:1.08rem;min-width:120px;';
      document.querySelector('main').appendChild(saveBtn);
    } else {
      saveBtn.style.display = 'block';
    }
    saveBtn.onclick = async function() {
      await saveAssignments();
      showPopup('Değişiklikler kaydedildi!');
    };
    // Sayfa yüklenince atamaları çek
    loadAssignments();
  </script>
</body>
</html>
